<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Producto | ContaEmprende</title>
    <link rel="stylesheet" href="../css/producto.css">
</head>
<body>
    <!-- Fondo animado -->
    <div class="animated-bg">
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="floating-icon icon-1">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                <line x1="12" y1="22.08" x2="12" y2="12"/>
            </svg>
        </div>
        <div class="floating-icon icon-2">
            <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
        </div>
    </div>

    <!-- Botón de regreso -->
    <button class="btn-back" onclick="window.location.href='inventario.html'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Volver
    </button>

    <div class="container">
        <!-- Header del formulario -->
        <div class="form-header">
            <div class="icon-container">
                <div class="icon-circle">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                        <line x1="12" y1="22.08" x2="12" y2="12"/>
                    </svg>
                </div>
            </div>
            <h1>Registrar Producto</h1>
            <p class="subtitle">Complete los datos del nuevo producto</p>
            
            <!-- Barra de progreso -->
            <div class="progress-container">
                <div class="progress-info">
                    <span class="progress-text">Progreso del formulario</span>
                    <span class="progress-percentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="progress-glow"></div>
                </div>
                <div class="progress-steps">
                    <div class="step completed">
                        <div class="step-circle">1</div>
                        <span>Inicio</span>
                    </div>
                    <div class="step">
                        <div class="step-circle">2</div>
                        <span>Datos</span>
                    </div>
                    <div class="step">
                        <div class="step-circle">3</div>
                        <span>Precios</span>
                    </div>
                    <div class="step">
                        <div class="step-circle">4</div>
                        <span>Completo</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- IMPORTANTE: Mantener id="productoForm" para que producto.js funcione -->
        <form id="productoForm">
            <!-- Fila 1: Nombre -->
            <div class="form-row">
                <div class="grupo">
                    <label for="nombre">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 7h-9M14 17H5M20 17h-5M4 7h5"/>
                            <circle cx="9" cy="7" r="2"/>
                            <circle cx="19" cy="17" r="2"/>
                        </svg>
                        Nombre del Producto
                    </label>
                    <input type="text" id="nombre" required placeholder="Ej: Laptop HP 15">
                    <div class="input-line"></div>
                </div>
            </div>

            <!-- Fila 2: Descripción -->
            <div class="form-row">
                <div class="grupo">
                    <label for="descripcion">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        Descripción
                    </label>
                    <textarea id="descripcion" rows="3" placeholder="Descripción detallada del producto..."></textarea>
                    <div class="input-line"></div>
                </div>
            </div>

            <!-- Fila 3: Precios -->
            <div class="form-row two-cols">
                <div class="grupo">
                    <label for="precio_compra">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"/>
                            <circle cx="20" cy="21" r="1"/>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                        </svg>
                        Precio Compra
                    </label>
                    <div class="input-wrapper">
                        <span class="currency">$</span>
                        <input type="number" id="precio_compra" step="0.01" required placeholder="0.00">
                    </div>
                    <div class="input-line"></div>
                </div>

                <div class="grupo">
                    <label for="precio_venta">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"/>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                        Precio Venta
                    </label>
                    <div class="input-wrapper">
                        <span class="currency">$</span>
                        <input type="number" id="precio_venta" step="0.01" required placeholder="0.00">
                    </div>
                    <div class="input-line"></div>
                </div>
            </div>

            <!-- Fila 4: Stock y Estado -->
            <div class="form-row two-cols">
                <div class="grupo">
                    <label for="stock">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                        </svg>
                        Stock Inicial
                    </label>
                    <input type="number" id="stock" min="0" required placeholder="0">
                    <div class="input-line"></div>
                </div>

                <div class="grupo">
                    <label for="estado">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        Estado
                    </label>
                    <select id="estado">
                        <option value="EN_USO">En Uso</option>
                        <option value="DANADO">Dañado</option>
                    </select>
                    <div class="input-line"></div>
                </div>
            </div>

            <!-- Fila 5: Proveedor -->
            <div class="form-row">
                <div class="grupo">
                    <label for="proveedor">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Proveedor
                    </label>
                    <select id="proveedor" required>
                        <option value="">Seleccione un proveedor...</option>
                        <!-- Los proveedores se cargan desde producto.js -->
                    </select>
                    <div class="input-line"></div>
                </div>
            </div>

            <!-- Botón de registro - IMPORTANTE: type="submit" para que funcione con producto.js -->
            <button type="submit" class="btn-submit">
                <span class="btn-text">Registrar Producto</span>
                <svg class="btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 11 12 14 22 4"/>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
            </button>

            <!-- Mensaje de resultado - IMPORTANTE: mantener id="msg" para producto.js -->
            <p id="msg" class="message"></p>
        </form>

        <!-- Footer del formulario -->
        <div class="form-footer">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
            </svg>
            <span>Todos los campos marcados son obligatorios</span>
        </div>
    </div>

    <!-- TU SCRIPT ORIGINAL - SE CARGA PRIMERO -->
    <script src="../js/producto.js"></script>
    
    <!-- Script de animaciones visuales -->
    <script>
        // Animaciones de entrada
        window.addEventListener('load', () => {
            const grupos = document.querySelectorAll('.grupo');
            grupos.forEach((grupo, index) => {
                setTimeout(() => {
                    grupo.classList.add('appear');
                }, index * 100);
            });
            
            // Actualizar progreso inicial
            updateProgress();
        });

        // Animación focus en inputs
        const inputs = document.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.closest('.grupo').classList.add('focused');
            });
            
            input.addEventListener('blur', function() {
                if (!this.value) {
                    this.closest('.grupo').classList.remove('focused');
                }
            });
            
            // Actualizar progreso al cambiar valores
            input.addEventListener('input', updateProgress);
            input.addEventListener('change', updateProgress);
        });

        // Función para actualizar la barra de progreso
        function updateProgress() {
            const requiredFields = document.querySelectorAll('input[required], select[required], textarea[required]');
            const totalFields = requiredFields.length;
            let filledFields = 0;
            
            requiredFields.forEach(field => {
                if (field.value.trim() !== '') {
                    filledFields++;
                }
            });
            
            // Calcular porcentaje
            const percentage = Math.round((filledFields / totalFields) * 100);
            
            // Actualizar barra
            const progressFill = document.getElementById('progressFill');
            const progressPercentage = document.querySelector('.progress-percentage');
            
            if (progressFill && progressPercentage) {
                progressFill.style.width = percentage + '%';
                progressPercentage.textContent = percentage + '%';
                
                // Cambiar color según progreso
                if (percentage < 50) {
                    progressFill.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
                } else if (percentage < 100) {
                    progressFill.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                } else {
                    progressFill.style.background = 'linear-gradient(90deg, #48bb78, #38a169)';
                }
            }
            
            // Actualizar pasos
            const steps = document.querySelectorAll('.step');
            steps.forEach((step, index) => {
                if (percentage >= (index * 33.33)) {
                    step.classList.add('completed');
                } else {
                    step.classList.remove('completed');
                }
            });
        }

        // Calcular margen de ganancia automáticamente
        const precioCompra = document.getElementById('precio_compra');
        const precioVenta = document.getElementById('precio_venta');
        
        function calcularMargen() {
            const compra = parseFloat(precioCompra.value) || 0;
            const venta = parseFloat(precioVenta.value) || 0;
            
            if (compra > 0 && venta > 0) {
                const margen = ((venta - compra) / compra * 100).toFixed(2);
                
                // Mostrar margen (opcional)
                if (margen > 0) {
                    console.log('Margen de ganancia: ${margen}%');
                }
            }
        }
        
        if (precioCompra && precioVenta) {
            precioCompra.addEventListener('input', calcularMargen);
            precioVenta.addEventListener('input', calcularMargen);
        }

        // Mejorar el mensaje visual cuando producto.js muestra resultados
        const observer = new MutationObserver(() => {
            const msg = document.getElementById('msg');
            if (msg && msg.textContent.trim() !== '') {
                if (msg.textContent.includes('correctamente') || msg.textContent.includes('exitosamente')) {
                    msg.classList.add('success');
                    msg.classList.remove('error');
                } else if (msg.textContent.includes('Error') || msg.textContent.includes('error')) {
                    msg.classList.add('error');
                    msg.classList.remove('success');
                }
            }
        });
        
        const msgElement = document.getElementById('msg');
        if (msgElement) {
            observer.observe(msgElement, { childList: true, characterData: true, subtree: true });
        }
    </script>
</body>
</html>